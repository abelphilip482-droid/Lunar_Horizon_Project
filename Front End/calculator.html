<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Solar Exposure Calculator</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
.moon-map-bg {
  background-image: url("moon_map.png");
  background-size: cover;
  background-position: center;
  position: relative;
}

.moon-map-bg::before {
  content: "";
  position: absolute;
  inset: 0;
  background: rgba(11,15,25,0.85);
  backdrop-filter: blur(2px);
}
</style>
</head>

<body class="bg-[#0b0f19] text-white font-['Inter']">

<!-- NAVBAR -->
<nav class="bg-[#0b0f19] text-white px-6 py-4 flex justify-between items-center border-b border-gray-800">
  <div class="flex items-center gap-3">
    <div class="w-8 h-8 bg-blue-400 rounded-full    "></div>
    <h1 class="font-['Orbitron'] text-lg">Lunar Horizon Mapper</h1>
  </div>

  <ul class="flex gap-6 text-gray-300">
    <li><a href="index.html" class="hover:text-blue-400">Home</a></li>
    <li><a href="calculator.html" class="text-blue-400">Calculator</a></li>
    <li><a href="rover.html" class="hover:text-blue-400">Rover</a></li>
    <li><a href="about.html" class="hover:text-blue-400">About</a></li>
  </ul>
</nav>

<!-- HEADER BANNER -->
<section class="moon-map-bg py-16 px-6">
  <div class="relative z-10 max-w-5xl mx-auto text-center">
    <h2 class="font-['Orbitron'] text-3xl mb-3">
      Solar Exposure Calculator
    </h2>
    <p class="text-gray-300">
      Select lunar coordinates and time window to compute illumination
    </p>
  </div>
</section>

<!-- CALCULATOR CARD -->
<section class="max-w-4xl mx-auto mt-10 bg-[#111827] p-8 rounded-xl shadow-lg border border-gray-800 relative z-10">

  <div class="grid grid-cols-2 gap-4">
    <input id="latitude" placeholder="Latitude (-90 to 90)" 
           class="bg-[#0b0f19] p-3 rounded text-white" type="number" min="-90" max="90" step="0.1">
    <input id="longitude" placeholder="Longitude (-180 to 180)" 
           class="bg-[#0b0f19] p-3 rounded text-white" type="number" min="-180" max="180" step="0.1">
    <input id="start_date" type="date" class="bg-[#0b0f19] p-3 rounded text-white">
    <input id="end_date" type="date" class="bg-[#0b0f19] p-3 rounded text-white">
  </div>

  <button id="analyzeBtn" type="button"
          class="mt-6 bg-blue-400 text-black px-6 py-3 rounded font-semibold hover:bg-blue-300">
    Analyze
  </button>
  <span id="status" class="ml-4 text-gray-400"></span>

</section>

<!-- RESULTS PLACEHOLDER -->
<section class="max-w-4xl mx-auto mt-10 space-y-6">

  <div class="bg-[#111827] p-6 rounded-xl border border-gray-800">
    <h3 class="font-['Orbitron'] text-xl mb-2">Illumination Summary</h3>
    <p>Total Sunlight Hours: <span id="sunlight_hours" class="text-blue-400 font-bold">-- hrs</span></p>
    <p id="location_info" class="text-gray-400 text-sm mt-2"></p>
    <p id="period_info" class="text-gray-400 text-sm"></p>
  </div>

  <div class="bg-[#111827] p-6 rounded-xl border border-gray-800">
    <h3 class="font-['Orbitron'] text-xl mb-2">Terrain Analysis</h3>
    <div id="graph_container" class="h-auto bg-[#0b0f19] rounded flex items-center justify-center text-gray-500 mt-4">
      <img id="terrain_graph" style="max-width: 100%; height: auto; display: none;">
      <span id="graph_placeholder">Graph will appear here</span>
    </div>
  </div>

</section>

<script>
document.getElementById('analyzeBtn').addEventListener('click', async function() {
  const latitude = document.getElementById('latitude').value;
  const longitude = document.getElementById('longitude').value;
  const start_date = document.getElementById('start_date').value;
  const end_date = document.getElementById('end_date').value;
  const status = document.getElementById('status');

  // Validate inputs
  if (!latitude || !longitude || !start_date || !end_date) {
    status.textContent = 'Please fill in all fields';
    status.style.color = '#ef4444';
    return;
  }

  status.textContent = 'Calculating (this may take a minute)...';
  status.style.color = '#60a5fa';

  try {
    const response = await fetch('http://localhost:5000/api/calculator', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        latitude: parseFloat(latitude),
        longitude: parseFloat(longitude),
        start_date: start_date,
        end_date: end_date
      })
    });

    const data = await response.json();

    if (response.ok) {
      // Handle success response
      if (data.success || !data.error) {
        if (data.sunlight_hours !== undefined) {
          document.getElementById('sunlight_hours').textContent = data.sunlight_hours.toFixed(2) + ' hrs';
        } else {
          document.getElementById('sunlight_hours').textContent = 'Calculated';
        }
        
        if (data.location) {
          document.getElementById('location_info').textContent = data.location;
        } else {
          document.getElementById('location_info').textContent = `Lat: ${latitude}, Lon: ${longitude}`;
        }
        
        if (data.period) {
          document.getElementById('period_info').textContent = data.period;
        } else {
          document.getElementById('period_info').textContent = `From ${start_date} to ${end_date}`;
        }
        
        // Store sunlight hours in localStorage for rover page
        localStorage.setItem('lunarSunlightHours', data.sunlight_hours.toFixed(2));
        
        // Display graph if available
        if (data.graph) {
          const img = document.getElementById('terrain_graph');
          img.src = 'data:image/png;base64,' + data.graph;
          img.style.display = 'block';
          document.getElementById('graph_placeholder').style.display = 'none';
        }
        
        status.textContent = 'Calculation complete!';
        status.style.color = '#10b981';
      } else {
        status.textContent = 'Error: ' + (data.error || 'Unknown error');
        status.style.color = '#ef4444';
      }
    } else {
      status.textContent = 'Error: ' + (data.error || 'Request failed');
      status.style.color = '#ef4444';
    }
  } catch (error) {
    status.textContent = 'Connection error: ' + error.message;
    status.style.color = '#ef4444';
  }
});
</script>

</body>
</html>